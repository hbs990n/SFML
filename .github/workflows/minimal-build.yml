name: Simple SFML Build

on:
  workflow_dispatch:

jobs:
  build-sfml:
    runs-on: windows-2025
    
    steps:
    - name: Checkout Code
      uses: actions/checkout@v4
    
    - name: Check Environment
      run: |
        echo "Checking available compilers..."
        where gcc
        where g++
        where ar
        g++ --version
        echo "Current directory:"
        pwd
        dir
        
    - name: Try Direct Compilation
      run: |
        echo "=== 尝试直接编译 ==="
        
        # 先检查头文件是否存在
        echo "检查头文件..."
        if exist include\SFML\System.hpp (
          echo "✓ 找到System.hpp"
        ) else (
          echo "✗ 未找到System.hpp"
          dir include
          exit 1
        )
        
        # 编译System模块
        echo "编译System模块..."
        cd src\SFML\System
        
        # 只编译几个基本文件测试
        g++ -c -I..\..\..\include -DSFML_STATIC Clock.cpp Err.cpp
        if errorlevel 1 (
          echo "编译失败，尝试不同的包含路径..."
          # 尝试相对路径
          g++ -c -I../../../../include -DSFML_STATIC Clock.cpp
        )
        
        # 检查是否生成了.o文件
        dir *.o
        
        # 如果有.o文件，创建库
        if exist *.o (
          ar rcs libsfml-system.a *.o
          echo "✓ System模块编译成功"
          mkdir ..\..\..\..\output\lib -Force
          copy libsfml-system.a ..\..\..\..\output\lib\
        )
        
        cd ..\..\..
    
    - name: Create Output Package
      run: |
        echo "=== 创建输出包 ==="
        
        # 创建基本目录结构
        mkdir -p SFML-output\include
        mkdir -p SFML-output\lib
        
        # 复制头文件
        if exist include\SFML (
          xcopy /E /I include\SFML SFML-output\include\SFML
          echo "✓ 头文件已复制"
        )
        
        # 复制库文件
        if exist output\lib\*.a (
          copy output\lib\*.a SFML-output\lib\
          echo "✓ 库文件已复制"
        )
        
        # 显示结果
        echo "输出内容:"
        dir SFML-output /s
        
        # 创建ZIP包
        7z a sfml-simple-build.zip SFML-output
        
    - name: Upload Artifact
      uses: actions/upload-artifact@v4
      with:
        name: SFML-Simple-Build
        path: sfml-simple-build.zip
