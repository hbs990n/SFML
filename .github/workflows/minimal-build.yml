name: Build SFML for PNG Animator

on:
  workflow_dispatch:  # 手动触发

jobs:
  build-sfml-minimal:
    name: Build SFML (MinGW x64 Static)
    runs-on: windows-2025
    
    steps:
    - name: Checkout Code (使用2.6.1标签)
      uses: actions/checkout@v4
      with:
        ref: 2.6.1  # 这是标签，不是分支
    
    - name: Setup MinGW (兼容版本)
      run: |
        # 下载与你本地匹配的WinLibs 15.2.0
        curl -Lo mingw64.zip https://github.com/brechtsanders/winlibs_mingw/releases/download/15.2.0posix-19.1.1-13.0.0-ucrt-r4/winlibs-x86_64-posix-seh-gcc-15.2.0-mingw-w64ucrt-13.0.0-r4.zip
        mkdir "C:\mingw64"
        tar -xf mingw64.zip -C "C:\mingw64" --strip-components=1
        echo "C:\mingw64\bin" >> $GITHUB_PATH
        g++ --version
    
    - name: Configure CMake
      run: |
        cmake -B build -G "MinGW Makefiles" ^
          -DCMAKE_BUILD_TYPE=Release ^
          -DBUILD_SHARED_LIBS=OFF ^
          -DSFML_BUILD_EXAMPLES=OFF ^
          -DSFML_BUILD_TESTS=OFF ^
          -DSFML_BUILD_DOC=OFF ^
          -DCMAKE_C_COMPILER=C:/mingw64/bin/gcc.exe ^
          -DCMAKE_CXX_COMPILER=C:/mingw64/bin/g++.exe
    
    - name: Build SFML
      run: |
        cmake --build build --config Release --parallel 4
    
    - name: Install and Package
      run: |
        # 创建输出目录
        mkdir SFML-2.6.1-MinGW
        mkdir SFML-2.6.1-MinGW\include
        mkdir SFML-2.6.1-MinGW\lib
        
        # 复制头文件
        xcopy /E /I include\SFML SFML-2.6.1-MinGW\include\SFML
        
        # 手动复制编译好的库
        if exist build\lib\Release\*.a (
          copy build\lib\Release\*.a SFML-2.6.1-MinGW\lib\
        )
        if exist build\SFML\System\Release\*.a (
          copy build\SFML\System\Release\*.a SFML-2.6.1-MinGW\lib\
        )
        if exist build\SFML\Window\Release\*.a (
          copy build\SFML\Window\Release\*.a SFML-2.6.1-MinGW\lib\
        )
        if exist build\SFML\Graphics\Release\*.a (
          copy build\SFML\Graphics\Release\*.a SFML-2.6.1-MinGW\lib\
        )
        
        # 显示结果
        dir SFML-2.6.1-MinGW\lib\
        
        # 创建ZIP包
        7z a -tzip SFML-2.6.1-MinGW-x64-static.zip SFML-2.6.1-MinGW
    
    - name: Upload Artifact
      uses: actions/upload-artifact@v4
      with:
        name: SFML-2.6.1-MinGW-x64-static
        path: SFML-2.6.1-MinGW-x64-static.zip
